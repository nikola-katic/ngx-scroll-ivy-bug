/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, Optional, Input, Output, NgZone } from '@angular/core';
import { Directionality } from '@angular/cdk/bidi';
import { RtlScrollAxisType } from '@angular/cdk/platform';
import { Observable, Subject, Subscription } from 'rxjs';
import { filter, map, tap, distinctUntilChanged } from 'rxjs/operators';
import { NgScrollbar } from 'ngx-scrollbar';
// Uncomment the following line in development mode
// import { NgScrollbar } from '../../src/public-api';
class ReachedFunctions {
    /**
     * @param {?} offset
     * @param {?} e
     * @return {?}
     */
    static reachedTop(offset, e) {
        return ReachedFunctions.reached(-e.target.scrollTop, 0, offset);
    }
    /**
     * @param {?} offset
     * @param {?} e
     * @return {?}
     */
    static reachedBottom(offset, e) {
        return ReachedFunctions.reached(e.target.scrollTop + e.target.clientHeight, e.target.scrollHeight, offset);
    }
    /**
     * @param {?} offset
     * @param {?} e
     * @param {?} direction
     * @param {?} rtlScrollAxisType
     * @return {?}
     */
    static reachedStart(offset, e, direction, rtlScrollAxisType) {
        if (direction === 'rtl') {
            if (rtlScrollAxisType === RtlScrollAxisType.NEGATED) {
                return ReachedFunctions.reached(e.target.scrollLeft, 0, offset);
            }
            if (rtlScrollAxisType === RtlScrollAxisType.INVERTED) {
                return ReachedFunctions.reached(-e.target.scrollLeft, 0, offset);
            }
            return ReachedFunctions.reached(e.target.scrollLeft + e.target.clientWidth, e.target.scrollWidth, offset);
        }
        return ReachedFunctions.reached(-e.target.scrollLeft, 0, offset);
    }
    /**
     * @param {?} offset
     * @param {?} e
     * @param {?} direction
     * @param {?} rtlScrollAxisType
     * @return {?}
     */
    static reachedEnd(offset, e, direction, rtlScrollAxisType) {
        if (direction === 'rtl') {
            if (rtlScrollAxisType === RtlScrollAxisType.NEGATED) {
                return ReachedFunctions.reached(-(e.target.scrollLeft - e.target.clientWidth), e.target.scrollWidth, offset);
            }
            if (rtlScrollAxisType === RtlScrollAxisType.INVERTED) {
                return ReachedFunctions.reached(-(e.target.scrollLeft + e.target.clientWidth), e.target.scrollWidth, offset);
            }
            return ReachedFunctions.reached(-e.target.scrollLeft, 0, offset);
        }
        return ReachedFunctions.reached(e.target.scrollLeft + e.target.clientWidth, e.target.scrollWidth, offset);
    }
    /**
     * @param {?} currPosition
     * @param {?} targetPosition
     * @param {?} offset
     * @return {?}
     */
    static reached(currPosition, targetPosition, offset) {
        return currPosition >= targetPosition - offset;
    }
}
/**
 * @abstract
 */
class ScrollReached {
    /**
     * @protected
     * @param {?} scrollbar
     * @param {?} zone
     */
    constructor(scrollbar, zone) {
        this.scrollbar = scrollbar;
        this.zone = zone;
        /**
         * offset: Reached offset value in px
         */
        this.offset = 0;
        /**
         * Stream that emits scroll event when `NgScrollbar.scrolled` is initialized.
         *
         * **NOTE:** This subject is used to hold the place of `NgScrollbar.scrolled` when it's not initialized yet
         */
        this.scrollEvent = new Subject();
        /**
         * subscription: Scrolled event subscription, used to unsubscribe from the event on destroy
         */
        this.subscription = Subscription.EMPTY;
        /**
         * A stream used to assign the reached output
         */
        this.reachedEvent = new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        (observer) => this.scrollReached().subscribe((/**
         * @param {?} _
         * @return {?}
         */
        _ => Promise.resolve().then((/**
         * @return {?}
         */
        () => this.zone.run((/**
         * @return {?}
         */
        () => observer.next(_)))))))));
        if (!scrollbar) {
            throw new Error('[NgScrollbarReached Directive]: Host element must be an NgScrollbar component.');
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.subscription.unsubscribe();
    }
    /**
     * @protected
     * @return {?}
     */
    scrollReached() {
        // current event
        /** @type {?} */
        let currEvent;
        return this.scrollEvent.pipe(tap((/**
         * @param {?} e
         * @return {?}
         */
        (e) => currEvent = e)), 
        // Check if it scroll has reached
        map((/**
         * @param {?} e
         * @return {?}
         */
        (e) => this.reached(this.offset, e))), 
        // Distinct until reached value has changed
        distinctUntilChanged(), 
        // Emit only if reached is true
        filter((/**
         * @param {?} reached
         * @return {?}
         */
        (reached) => reached)), 
        // Return scroll event
        map((/**
         * @return {?}
         */
        () => currEvent)));
    }
}
ScrollReached.propDecorators = {
    offset: [{ type: Input, args: ['reachedOffset',] }]
};
if (false) {
    /**
     * offset: Reached offset value in px
     * @type {?}
     */
    ScrollReached.prototype.offset;
    /**
     * Stream that emits scroll event when `NgScrollbar.scrolled` is initialized.
     *
     * **NOTE:** This subject is used to hold the place of `NgScrollbar.scrolled` when it's not initialized yet
     * @type {?}
     * @protected
     */
    ScrollReached.prototype.scrollEvent;
    /**
     * subscription: Scrolled event subscription, used to unsubscribe from the event on destroy
     * @type {?}
     * @protected
     */
    ScrollReached.prototype.subscription;
    /**
     * A stream used to assign the reached output
     * @type {?}
     * @protected
     */
    ScrollReached.prototype.reachedEvent;
    /**
     * @type {?}
     * @protected
     */
    ScrollReached.prototype.scrollbar;
    /**
     * @type {?}
     * @protected
     */
    ScrollReached.prototype.zone;
    /**
     * @abstract
     * @protected
     * @param {?} offset
     * @param {?=} e
     * @return {?}
     */
    ScrollReached.prototype.reached = function (offset, e) { };
}
/**
 * @abstract
 */
class VerticalScrollReached extends ScrollReached {
    /**
     * @protected
     * @param {?} scrollbar
     * @param {?} zone
     */
    constructor(scrollbar, zone) {
        super(scrollbar, zone);
        this.scrollbar = scrollbar;
        this.zone = zone;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.subscription = this.scrollbar.verticalScrolled.subscribe(this.scrollEvent);
    }
}
/** @nocollapse */
VerticalScrollReached.ctorParameters = () => [
    { type: NgScrollbar, decorators: [{ type: Optional }] },
    { type: NgZone }
];
if (false) {
    /**
     * @type {?}
     * @protected
     */
    VerticalScrollReached.prototype.scrollbar;
    /**
     * @type {?}
     * @protected
     */
    VerticalScrollReached.prototype.zone;
}
/**
 * @abstract
 */
class HorizontalScrollReached extends ScrollReached {
    /**
     * @protected
     * @param {?} scrollbar
     * @param {?} zone
     */
    constructor(scrollbar, zone) {
        super(scrollbar, zone);
        this.scrollbar = scrollbar;
        this.zone = zone;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.subscription = this.scrollbar.horizontalScrolled.subscribe(this.scrollEvent);
    }
}
/** @nocollapse */
HorizontalScrollReached.ctorParameters = () => [
    { type: NgScrollbar, decorators: [{ type: Optional }] },
    { type: NgZone }
];
if (false) {
    /**
     * @type {?}
     * @protected
     */
    HorizontalScrollReached.prototype.scrollbar;
    /**
     * @type {?}
     * @protected
     */
    HorizontalScrollReached.prototype.zone;
}
export class NgScrollbarReachedTop extends VerticalScrollReached {
    /**
     * @param {?} scrollbar
     * @param {?} zone
     */
    constructor(scrollbar, zone) {
        super(scrollbar, zone);
        this.scrollbar = scrollbar;
        this.zone = zone;
        /**
         * Stream that emits when scroll has reached the top
         */
        this.reachedTop = this.reachedEvent;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        super.ngOnInit();
    }
    /**
     * Check if scroll has reached the top (vertically)
     * @protected
     * @param {?} offset Scroll offset
     * @param {?} e Scroll event
     * @return {?}
     */
    reached(offset, e) {
        return ReachedFunctions.reachedTop(offset, e);
    }
}
NgScrollbarReachedTop.decorators = [
    { type: Directive, args: [{
                selector: '[reachedTop], [reached-top]',
            },] }
];
/** @nocollapse */
NgScrollbarReachedTop.ctorParameters = () => [
    { type: NgScrollbar, decorators: [{ type: Optional }] },
    { type: NgZone }
];
NgScrollbarReachedTop.propDecorators = {
    reachedTop: [{ type: Output }]
};
if (false) {
    /**
     * Stream that emits when scroll has reached the top
     * @type {?}
     */
    NgScrollbarReachedTop.prototype.reachedTop;
    /**
     * @type {?}
     * @protected
     */
    NgScrollbarReachedTop.prototype.scrollbar;
    /**
     * @type {?}
     * @protected
     */
    NgScrollbarReachedTop.prototype.zone;
}
export class NgScrollbarReachedBottom extends VerticalScrollReached {
    /**
     * @param {?} scrollbar
     * @param {?} zone
     */
    constructor(scrollbar, zone) {
        super(scrollbar, zone);
        this.scrollbar = scrollbar;
        this.zone = zone;
        /**
         * Stream that emits when scroll has reached the bottom
         */
        this.reachedBottom = this.reachedEvent;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        super.ngOnInit();
    }
    /**
     * Check if scroll has reached the bottom (vertically)
     * @protected
     * @param {?} offset Scroll offset
     * @param {?} e Scroll event
     * @return {?}
     */
    reached(offset, e) {
        return ReachedFunctions.reachedBottom(offset, e);
    }
}
NgScrollbarReachedBottom.decorators = [
    { type: Directive, args: [{
                selector: '[reachedBottom], [reached-bottom]',
            },] }
];
/** @nocollapse */
NgScrollbarReachedBottom.ctorParameters = () => [
    { type: NgScrollbar, decorators: [{ type: Optional }] },
    { type: NgZone }
];
NgScrollbarReachedBottom.propDecorators = {
    reachedBottom: [{ type: Output }]
};
if (false) {
    /**
     * Stream that emits when scroll has reached the bottom
     * @type {?}
     */
    NgScrollbarReachedBottom.prototype.reachedBottom;
    /**
     * @type {?}
     * @protected
     */
    NgScrollbarReachedBottom.prototype.scrollbar;
    /**
     * @type {?}
     * @protected
     */
    NgScrollbarReachedBottom.prototype.zone;
}
export class NgScrollbarReachedStart extends HorizontalScrollReached {
    /**
     * @param {?} scrollbar
     * @param {?} zone
     * @param {?} dir
     */
    constructor(scrollbar, zone, dir) {
        super(scrollbar, zone);
        this.scrollbar = scrollbar;
        this.zone = zone;
        this.dir = dir;
        /**
         * Stream that emits when scroll has reached the start
         */
        this.reachedStart = this.reachedEvent;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        super.ngOnInit();
    }
    /**
     * Check if scroll has reached the start (horizontally)
     * @protected
     * @param {?} offset Scroll offset
     * @param {?} e Scroll event
     * @return {?}
     */
    reached(offset, e) {
        return ReachedFunctions.reachedStart(offset, e, this.dir.value, this.scrollbar.manager.rtlScrollAxisType);
    }
}
NgScrollbarReachedStart.decorators = [
    { type: Directive, args: [{
                selector: '[reachedStart], [reached-start]',
            },] }
];
/** @nocollapse */
NgScrollbarReachedStart.ctorParameters = () => [
    { type: NgScrollbar, decorators: [{ type: Optional }] },
    { type: NgZone },
    { type: Directionality }
];
NgScrollbarReachedStart.propDecorators = {
    reachedStart: [{ type: Output }]
};
if (false) {
    /**
     * Stream that emits when scroll has reached the start
     * @type {?}
     */
    NgScrollbarReachedStart.prototype.reachedStart;
    /**
     * @type {?}
     * @protected
     */
    NgScrollbarReachedStart.prototype.scrollbar;
    /**
     * @type {?}
     * @protected
     */
    NgScrollbarReachedStart.prototype.zone;
    /**
     * @type {?}
     * @private
     */
    NgScrollbarReachedStart.prototype.dir;
}
export class NgScrollbarReachedEnd extends HorizontalScrollReached {
    /**
     * @param {?} scrollbar
     * @param {?} zone
     * @param {?} dir
     */
    constructor(scrollbar, zone, dir) {
        super(scrollbar, zone);
        this.scrollbar = scrollbar;
        this.zone = zone;
        this.dir = dir;
        /**
         * Stream that emits when scroll has reached the end
         */
        this.reachedEnd = this.reachedEvent;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        super.ngOnInit();
    }
    /**
     * Check if scroll has reached the end (horizontally)
     * @protected
     * @param {?} offset Scroll offset
     * @param {?} e Scroll event
     * @return {?}
     */
    reached(offset, e) {
        return ReachedFunctions.reachedEnd(offset, e, this.dir.value, this.scrollbar.manager.rtlScrollAxisType);
    }
}
NgScrollbarReachedEnd.decorators = [
    { type: Directive, args: [{
                selector: '[reachedEnd], [reached-end]',
            },] }
];
/** @nocollapse */
NgScrollbarReachedEnd.ctorParameters = () => [
    { type: NgScrollbar, decorators: [{ type: Optional }] },
    { type: NgZone },
    { type: Directionality }
];
NgScrollbarReachedEnd.propDecorators = {
    reachedEnd: [{ type: Output }]
};
if (false) {
    /**
     * Stream that emits when scroll has reached the end
     * @type {?}
     */
    NgScrollbarReachedEnd.prototype.reachedEnd;
    /**
     * @type {?}
     * @protected
     */
    NgScrollbarReachedEnd.prototype.scrollbar;
    /**
     * @type {?}
     * @protected
     */
    NgScrollbarReachedEnd.prototype.zone;
    /**
     * @type {?}
     * @private
     */
    NgScrollbarReachedEnd.prototype.dir;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctc2Nyb2xsYmFyLXJlYWNoZWQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtc2Nyb2xsYmFyL3JlYWNoZWQtZXZlbnQvIiwic291cmNlcyI6WyJuZy1zY3JvbGxiYXItcmVhY2hlZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBcUIsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzlGLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxZQUFZLEVBQVksTUFBTSxNQUFNLENBQUM7QUFDbkUsT0FBTyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEUsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQzs7O0FBSTVDLE1BQU0sZ0JBQWdCOzs7Ozs7SUFDcEIsTUFBTSxDQUFDLFVBQVUsQ0FBQyxNQUFjLEVBQUUsQ0FBTTtRQUN0QyxPQUFPLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNsRSxDQUFDOzs7Ozs7SUFFRCxNQUFNLENBQUMsYUFBYSxDQUFDLE1BQWMsRUFBRSxDQUFNO1FBQ3pDLE9BQU8sZ0JBQWdCLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsU0FBUyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzdHLENBQUM7Ozs7Ozs7O0lBRUQsTUFBTSxDQUFDLFlBQVksQ0FBQyxNQUFjLEVBQUUsQ0FBTSxFQUFFLFNBQXdCLEVBQUUsaUJBQW9DO1FBQ3hHLElBQUksU0FBUyxLQUFLLEtBQUssRUFBRTtZQUN2QixJQUFJLGlCQUFpQixLQUFLLGlCQUFpQixDQUFDLE9BQU8sRUFBRTtnQkFDbkQsT0FBTyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO2FBQ2pFO1lBQ0QsSUFBSSxpQkFBaUIsS0FBSyxpQkFBaUIsQ0FBQyxRQUFRLEVBQUU7Z0JBQ3BELE9BQU8sZ0JBQWdCLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO2FBQ2xFO1lBQ0QsT0FBTyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxXQUFXLEVBQUUsTUFBTSxDQUFDLENBQUM7U0FDM0c7UUFDRCxPQUFPLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBVSxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNuRSxDQUFDOzs7Ozs7OztJQUVELE1BQU0sQ0FBQyxVQUFVLENBQUMsTUFBYyxFQUFFLENBQU0sRUFBRSxTQUF3QixFQUFFLGlCQUFvQztRQUN0RyxJQUFJLFNBQVMsS0FBSyxLQUFLLEVBQUU7WUFDdkIsSUFBSSxpQkFBaUIsS0FBSyxpQkFBaUIsQ0FBQyxPQUFPLEVBQUU7Z0JBQ25ELE9BQU8sZ0JBQWdCLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsV0FBVyxFQUFFLE1BQU0sQ0FBQyxDQUFDO2FBQzlHO1lBQ0QsSUFBSSxpQkFBaUIsS0FBSyxpQkFBaUIsQ0FBQyxRQUFRLEVBQUU7Z0JBQ3BELE9BQU8sZ0JBQWdCLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsV0FBVyxFQUFFLE1BQU0sQ0FBQyxDQUFDO2FBQzlHO1lBQ0QsT0FBTyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7U0FDbEU7UUFDRCxPQUFPLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUM1RyxDQUFDOzs7Ozs7O0lBRUQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxZQUFvQixFQUFFLGNBQXNCLEVBQUUsTUFBYztRQUN6RSxPQUFPLFlBQVksSUFBSSxjQUFjLEdBQUcsTUFBTSxDQUFDO0lBQ2pELENBQUM7Q0FDRjs7OztBQUVELE1BQWUsYUFBYTs7Ozs7O0lBb0IxQixZQUFnQyxTQUFzQixFQUFZLElBQVk7UUFBOUMsY0FBUyxHQUFULFNBQVMsQ0FBYTtRQUFZLFNBQUksR0FBSixJQUFJLENBQVE7Ozs7UUFqQnRELFdBQU0sR0FBRyxDQUFDLENBQUM7Ozs7OztRQU96QixnQkFBVyxHQUFHLElBQUksT0FBTyxFQUFPLENBQUM7Ozs7UUFHakMsaUJBQVksR0FBRyxZQUFZLENBQUMsS0FBSyxDQUFDOzs7O1FBR2xDLGlCQUFZLEdBQUcsSUFBSSxVQUFVOzs7O1FBQUMsQ0FBQyxRQUF1QixFQUFFLEVBQUUsQ0FDbEUsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDLFNBQVM7Ozs7UUFBQyxDQUFDLENBQUMsRUFBRSxDQUNqQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUMsSUFBSTs7O1FBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHOzs7UUFBQyxHQUFHLEVBQUUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFDLEVBQUMsRUFBQyxFQUFDLENBQUM7UUFHeEUsSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNkLE1BQU0sSUFBSSxLQUFLLENBQUMsZ0ZBQWdGLENBQUMsQ0FBQztTQUNuRztJQUNILENBQUM7Ozs7SUFFRCxXQUFXO1FBQ1QsSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUNsQyxDQUFDOzs7OztJQUVTLGFBQWE7OztZQUVqQixTQUFjO1FBRWxCLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQzFCLEdBQUc7Ozs7UUFBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsU0FBUyxHQUFHLENBQUMsRUFBQztRQUN6QixpQ0FBaUM7UUFDakMsR0FBRzs7OztRQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLEVBQUM7UUFDeEMsMkNBQTJDO1FBQzNDLG9CQUFvQixFQUFFO1FBQ3RCLCtCQUErQjtRQUMvQixNQUFNOzs7O1FBQUMsQ0FBQyxPQUFnQixFQUFFLEVBQUUsQ0FBQyxPQUFPLEVBQUM7UUFDckMsc0JBQXNCO1FBQ3RCLEdBQUc7OztRQUFDLEdBQUcsRUFBRSxDQUFDLFNBQVMsRUFBQyxDQUNyQixDQUFDO0lBQ0osQ0FBQzs7O3FCQTFDQSxLQUFLLFNBQUMsZUFBZTs7Ozs7OztJQUF0QiwrQkFBbUM7Ozs7Ozs7O0lBT25DLG9DQUEyQzs7Ozs7O0lBRzNDLHFDQUE0Qzs7Ozs7O0lBRzVDLHFDQUUwRTs7Ozs7SUFFcEQsa0NBQWdDOzs7OztJQUFFLDZCQUFzQjs7Ozs7Ozs7SUEyQjlFLDJEQUE2RDs7Ozs7QUFHL0QsTUFBZSxxQkFBc0IsU0FBUSxhQUFhOzs7Ozs7SUFDeEQsWUFBNEMsU0FBc0IsRUFBWSxJQUFZO1FBQ3hGLEtBQUssQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFEbUIsY0FBUyxHQUFULFNBQVMsQ0FBYTtRQUFZLFNBQUksR0FBSixJQUFJLENBQVE7SUFFMUYsQ0FBQzs7OztJQUVELFFBQVE7UUFDTixJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUNsRixDQUFDOzs7O1lBckdNLFdBQVcsdUJBK0ZLLFFBQVE7WUFwRytCLE1BQU07Ozs7Ozs7SUFvRzlDLDBDQUE0Qzs7Ozs7SUFBRSxxQ0FBc0I7Ozs7O0FBUzVGLE1BQWUsdUJBQXdCLFNBQVEsYUFBYTs7Ozs7O0lBQzFELFlBQTRDLFNBQXNCLEVBQVksSUFBWTtRQUN4RixLQUFLLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBRG1CLGNBQVMsR0FBVCxTQUFTLENBQWE7UUFBWSxTQUFJLEdBQUosSUFBSSxDQUFRO0lBRTFGLENBQUM7Ozs7SUFFRCxRQUFRO1FBQ04sSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLGtCQUFrQixDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDcEYsQ0FBQzs7OztZQS9HTSxXQUFXLHVCQXlHSyxRQUFRO1lBOUcrQixNQUFNOzs7Ozs7O0lBOEc5Qyw0Q0FBNEM7Ozs7O0lBQUUsdUNBQXNCOztBQVk1RixNQUFNLE9BQU8scUJBQXNCLFNBQVEscUJBQXFCOzs7OztJQUs5RCxZQUFrQyxTQUFzQixFQUFZLElBQVk7UUFDOUUsS0FBSyxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsQ0FBQztRQURTLGNBQVMsR0FBVCxTQUFTLENBQWE7UUFBWSxTQUFJLEdBQUosSUFBSSxDQUFROzs7O1FBRnRFLGVBQVUsR0FBb0IsSUFBSSxDQUFDLFlBQVksQ0FBQztJQUkxRCxDQUFDOzs7O0lBRUQsUUFBUTtRQUNOLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUNuQixDQUFDOzs7Ozs7OztJQU9TLE9BQU8sQ0FBQyxNQUFjLEVBQUUsQ0FBTTtRQUN0QyxPQUFPLGdCQUFnQixDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDaEQsQ0FBQzs7O1lBdkJGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsNkJBQTZCO2FBQ3hDOzs7O1lBcEhRLFdBQVcsdUJBMEhMLFFBQVE7WUEvSHlDLE1BQU07Ozt5QkE2SG5FLE1BQU07Ozs7Ozs7SUFBUCwyQ0FBMEQ7Ozs7O0lBRTlDLDBDQUE0Qzs7Ozs7SUFBRSxxQ0FBc0I7O0FBcUJsRixNQUFNLE9BQU8sd0JBQXlCLFNBQVEscUJBQXFCOzs7OztJQUtqRSxZQUFrQyxTQUFzQixFQUFZLElBQVk7UUFDOUUsS0FBSyxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsQ0FBQztRQURTLGNBQVMsR0FBVCxTQUFTLENBQWE7UUFBWSxTQUFJLEdBQUosSUFBSSxDQUFROzs7O1FBRnRFLGtCQUFhLEdBQW9CLElBQUksQ0FBQyxZQUFZLENBQUM7SUFJN0QsQ0FBQzs7OztJQUVELFFBQVE7UUFDTixLQUFLLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDbkIsQ0FBQzs7Ozs7Ozs7SUFPUyxPQUFPLENBQUMsTUFBYyxFQUFFLENBQU07UUFDdEMsT0FBTyxnQkFBZ0IsQ0FBQyxhQUFhLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ25ELENBQUM7OztZQXZCRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLG1DQUFtQzthQUM5Qzs7OztZQTlJUSxXQUFXLHVCQW9KTCxRQUFRO1lBekp5QyxNQUFNOzs7NEJBdUpuRSxNQUFNOzs7Ozs7O0lBQVAsaURBQTZEOzs7OztJQUVqRCw2Q0FBNEM7Ozs7O0lBQUUsd0NBQXNCOztBQXFCbEYsTUFBTSxPQUFPLHVCQUF3QixTQUFRLHVCQUF1Qjs7Ozs7O0lBS2xFLFlBQWtDLFNBQXNCLEVBQVksSUFBWSxFQUFVLEdBQW1CO1FBQzNHLEtBQUssQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFEUyxjQUFTLEdBQVQsU0FBUyxDQUFhO1FBQVksU0FBSSxHQUFKLElBQUksQ0FBUTtRQUFVLFFBQUcsR0FBSCxHQUFHLENBQWdCOzs7O1FBRm5HLGlCQUFZLEdBQW9CLElBQUksQ0FBQyxZQUFZLENBQUM7SUFJNUQsQ0FBQzs7OztJQUVELFFBQVE7UUFDTixLQUFLLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDbkIsQ0FBQzs7Ozs7Ozs7SUFPUyxPQUFPLENBQUMsTUFBYyxFQUFFLENBQU07UUFDdEMsT0FBTyxnQkFBZ0IsQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0lBQzVHLENBQUM7OztZQXZCRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLGlDQUFpQzthQUM1Qzs7OztZQXhLUSxXQUFXLHVCQThLTCxRQUFRO1lBbkx5QyxNQUFNO1lBQzdELGNBQWM7OzsyQkFnTHBCLE1BQU07Ozs7Ozs7SUFBUCwrQ0FBNEQ7Ozs7O0lBRWhELDRDQUE0Qzs7Ozs7SUFBRSx1Q0FBc0I7Ozs7O0lBQUUsc0NBQTJCOztBQXFCL0csTUFBTSxPQUFPLHFCQUFzQixTQUFRLHVCQUF1Qjs7Ozs7O0lBS2hFLFlBQWtDLFNBQXNCLEVBQVksSUFBWSxFQUFVLEdBQW1CO1FBQzNHLEtBQUssQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFEUyxjQUFTLEdBQVQsU0FBUyxDQUFhO1FBQVksU0FBSSxHQUFKLElBQUksQ0FBUTtRQUFVLFFBQUcsR0FBSCxHQUFHLENBQWdCOzs7O1FBRm5HLGVBQVUsR0FBb0IsSUFBSSxDQUFDLFlBQVksQ0FBQztJQUkxRCxDQUFDOzs7O0lBRUQsUUFBUTtRQUNOLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUNuQixDQUFDOzs7Ozs7OztJQU9TLE9BQU8sQ0FBQyxNQUFjLEVBQUUsQ0FBTTtRQUN0QyxPQUFPLGdCQUFnQixDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUM7SUFDMUcsQ0FBQzs7O1lBdkJGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsNkJBQTZCO2FBQ3hDOzs7O1lBbE1RLFdBQVcsdUJBd01MLFFBQVE7WUE3TXlDLE1BQU07WUFDN0QsY0FBYzs7O3lCQTBNcEIsTUFBTTs7Ozs7OztJQUFQLDJDQUEwRDs7Ozs7SUFFOUMsMENBQTRDOzs7OztJQUFFLHFDQUFzQjs7Ozs7SUFBRSxvQ0FBMkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEaXJlY3RpdmUsIE9wdGlvbmFsLCBJbnB1dCwgT3V0cHV0LCBPbkluaXQsIE9uRGVzdHJveSwgTmdab25lIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERpcmVjdGlvbmFsaXR5IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2JpZGknO1xyXG5pbXBvcnQgeyBSdGxTY3JvbGxBeGlzVHlwZSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9wbGF0Zm9ybSc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QsIFN1YnNjcmlwdGlvbiwgT2JzZXJ2ZXIgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgZmlsdGVyLCBtYXAsIHRhcCwgZGlzdGluY3RVbnRpbENoYW5nZWQgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IE5nU2Nyb2xsYmFyIH0gZnJvbSAnbmd4LXNjcm9sbGJhcic7XHJcbi8vIFVuY29tbWVudCB0aGUgZm9sbG93aW5nIGxpbmUgaW4gZGV2ZWxvcG1lbnQgbW9kZVxyXG4vLyBpbXBvcnQgeyBOZ1Njcm9sbGJhciB9IGZyb20gJy4uLy4uL3NyYy9wdWJsaWMtYXBpJztcclxuXHJcbmNsYXNzIFJlYWNoZWRGdW5jdGlvbnMge1xyXG4gIHN0YXRpYyByZWFjaGVkVG9wKG9mZnNldDogbnVtYmVyLCBlOiBhbnkpOiBib29sZWFuIHtcclxuICAgIHJldHVybiBSZWFjaGVkRnVuY3Rpb25zLnJlYWNoZWQoLWUudGFyZ2V0LnNjcm9sbFRvcCwgMCwgb2Zmc2V0KTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyByZWFjaGVkQm90dG9tKG9mZnNldDogbnVtYmVyLCBlOiBhbnkpOiBib29sZWFuIHtcclxuICAgIHJldHVybiBSZWFjaGVkRnVuY3Rpb25zLnJlYWNoZWQoZS50YXJnZXQuc2Nyb2xsVG9wICsgZS50YXJnZXQuY2xpZW50SGVpZ2h0LCBlLnRhcmdldC5zY3JvbGxIZWlnaHQsIG9mZnNldCk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgcmVhY2hlZFN0YXJ0KG9mZnNldDogbnVtYmVyLCBlOiBhbnksIGRpcmVjdGlvbjogJ2x0cicgfCAncnRsJywgcnRsU2Nyb2xsQXhpc1R5cGU6IFJ0bFNjcm9sbEF4aXNUeXBlKTogYm9vbGVhbiB7XHJcbiAgICBpZiAoZGlyZWN0aW9uID09PSAncnRsJykge1xyXG4gICAgICBpZiAocnRsU2Nyb2xsQXhpc1R5cGUgPT09IFJ0bFNjcm9sbEF4aXNUeXBlLk5FR0FURUQpIHtcclxuICAgICAgICByZXR1cm4gUmVhY2hlZEZ1bmN0aW9ucy5yZWFjaGVkKGUudGFyZ2V0LnNjcm9sbExlZnQsIDAsIG9mZnNldCk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHJ0bFNjcm9sbEF4aXNUeXBlID09PSBSdGxTY3JvbGxBeGlzVHlwZS5JTlZFUlRFRCkge1xyXG4gICAgICAgIHJldHVybiBSZWFjaGVkRnVuY3Rpb25zLnJlYWNoZWQoLWUudGFyZ2V0LnNjcm9sbExlZnQsIDAsIG9mZnNldCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFJlYWNoZWRGdW5jdGlvbnMucmVhY2hlZChlLnRhcmdldC5zY3JvbGxMZWZ0ICsgZS50YXJnZXQuY2xpZW50V2lkdGgsIGUudGFyZ2V0LnNjcm9sbFdpZHRoLCBvZmZzZXQpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIFJlYWNoZWRGdW5jdGlvbnMucmVhY2hlZCgtZS50YXJnZXQuc2Nyb2xsTGVmdCwgMCwgb2Zmc2V0KTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyByZWFjaGVkRW5kKG9mZnNldDogbnVtYmVyLCBlOiBhbnksIGRpcmVjdGlvbjogJ2x0cicgfCAncnRsJywgcnRsU2Nyb2xsQXhpc1R5cGU6IFJ0bFNjcm9sbEF4aXNUeXBlKTogYm9vbGVhbiB7XHJcbiAgICBpZiAoZGlyZWN0aW9uID09PSAncnRsJykge1xyXG4gICAgICBpZiAocnRsU2Nyb2xsQXhpc1R5cGUgPT09IFJ0bFNjcm9sbEF4aXNUeXBlLk5FR0FURUQpIHtcclxuICAgICAgICByZXR1cm4gUmVhY2hlZEZ1bmN0aW9ucy5yZWFjaGVkKC0oZS50YXJnZXQuc2Nyb2xsTGVmdCAtIGUudGFyZ2V0LmNsaWVudFdpZHRoKSwgZS50YXJnZXQuc2Nyb2xsV2lkdGgsIG9mZnNldCk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHJ0bFNjcm9sbEF4aXNUeXBlID09PSBSdGxTY3JvbGxBeGlzVHlwZS5JTlZFUlRFRCkge1xyXG4gICAgICAgIHJldHVybiBSZWFjaGVkRnVuY3Rpb25zLnJlYWNoZWQoLShlLnRhcmdldC5zY3JvbGxMZWZ0ICsgZS50YXJnZXQuY2xpZW50V2lkdGgpLCBlLnRhcmdldC5zY3JvbGxXaWR0aCwgb2Zmc2V0KTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gUmVhY2hlZEZ1bmN0aW9ucy5yZWFjaGVkKC1lLnRhcmdldC5zY3JvbGxMZWZ0LCAwLCBvZmZzZXQpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIFJlYWNoZWRGdW5jdGlvbnMucmVhY2hlZChlLnRhcmdldC5zY3JvbGxMZWZ0ICsgZS50YXJnZXQuY2xpZW50V2lkdGgsIGUudGFyZ2V0LnNjcm9sbFdpZHRoLCBvZmZzZXQpO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIHJlYWNoZWQoY3VyclBvc2l0aW9uOiBudW1iZXIsIHRhcmdldFBvc2l0aW9uOiBudW1iZXIsIG9mZnNldDogbnVtYmVyKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gY3VyclBvc2l0aW9uID49IHRhcmdldFBvc2l0aW9uIC0gb2Zmc2V0O1xyXG4gIH1cclxufVxyXG5cclxuYWJzdHJhY3QgY2xhc3MgU2Nyb2xsUmVhY2hlZCBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XHJcblxyXG4gIC8qKiBvZmZzZXQ6IFJlYWNoZWQgb2Zmc2V0IHZhbHVlIGluIHB4ICovXHJcbiAgQElucHV0KCdyZWFjaGVkT2Zmc2V0Jykgb2Zmc2V0ID0gMDtcclxuXHJcbiAgLyoqXHJcbiAgICogU3RyZWFtIHRoYXQgZW1pdHMgc2Nyb2xsIGV2ZW50IHdoZW4gYE5nU2Nyb2xsYmFyLnNjcm9sbGVkYCBpcyBpbml0aWFsaXplZC5cclxuICAgKlxyXG4gICAqICoqTk9URToqKiBUaGlzIHN1YmplY3QgaXMgdXNlZCB0byBob2xkIHRoZSBwbGFjZSBvZiBgTmdTY3JvbGxiYXIuc2Nyb2xsZWRgIHdoZW4gaXQncyBub3QgaW5pdGlhbGl6ZWQgeWV0XHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIHNjcm9sbEV2ZW50ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG5cclxuICAvKiogc3Vic2NyaXB0aW9uOiBTY3JvbGxlZCBldmVudCBzdWJzY3JpcHRpb24sIHVzZWQgdG8gdW5zdWJzY3JpYmUgZnJvbSB0aGUgZXZlbnQgb24gZGVzdHJveSAqL1xyXG4gIHByb3RlY3RlZCBzdWJzY3JpcHRpb24gPSBTdWJzY3JpcHRpb24uRU1QVFk7XHJcblxyXG4gIC8qKiBBIHN0cmVhbSB1c2VkIHRvIGFzc2lnbiB0aGUgcmVhY2hlZCBvdXRwdXQgKi9cclxuICBwcm90ZWN0ZWQgcmVhY2hlZEV2ZW50ID0gbmV3IE9ic2VydmFibGUoKG9ic2VydmVyOiBPYnNlcnZlcjxhbnk+KSA9PlxyXG4gICAgdGhpcy5zY3JvbGxSZWFjaGVkKCkuc3Vic2NyaWJlKF8gPT5cclxuICAgICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbigoKSA9PiB0aGlzLnpvbmUucnVuKCgpID0+IG9ic2VydmVyLm5leHQoXykpKSkpO1xyXG5cclxuICBwcm90ZWN0ZWQgY29uc3RydWN0b3IocHJvdGVjdGVkIHNjcm9sbGJhcjogTmdTY3JvbGxiYXIsIHByb3RlY3RlZCB6b25lOiBOZ1pvbmUpIHtcclxuICAgIGlmICghc2Nyb2xsYmFyKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignW05nU2Nyb2xsYmFyUmVhY2hlZCBEaXJlY3RpdmVdOiBIb3N0IGVsZW1lbnQgbXVzdCBiZSBhbiBOZ1Njcm9sbGJhciBjb21wb25lbnQuJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpIHtcclxuICAgIHRoaXMuc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgc2Nyb2xsUmVhY2hlZCgpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgLy8gY3VycmVudCBldmVudFxyXG4gICAgbGV0IGN1cnJFdmVudDogYW55O1xyXG5cclxuICAgIHJldHVybiB0aGlzLnNjcm9sbEV2ZW50LnBpcGUoXHJcbiAgICAgIHRhcCgoZSkgPT4gY3VyckV2ZW50ID0gZSksXHJcbiAgICAgIC8vIENoZWNrIGlmIGl0IHNjcm9sbCBoYXMgcmVhY2hlZFxyXG4gICAgICBtYXAoKGUpID0+IHRoaXMucmVhY2hlZCh0aGlzLm9mZnNldCwgZSkpLFxyXG4gICAgICAvLyBEaXN0aW5jdCB1bnRpbCByZWFjaGVkIHZhbHVlIGhhcyBjaGFuZ2VkXHJcbiAgICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKCksXHJcbiAgICAgIC8vIEVtaXQgb25seSBpZiByZWFjaGVkIGlzIHRydWVcclxuICAgICAgZmlsdGVyKChyZWFjaGVkOiBib29sZWFuKSA9PiByZWFjaGVkKSxcclxuICAgICAgLy8gUmV0dXJuIHNjcm9sbCBldmVudFxyXG4gICAgICBtYXAoKCkgPT4gY3VyckV2ZW50KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBhYnN0cmFjdCByZWFjaGVkKG9mZnNldDogbnVtYmVyLCBlPzogYW55KTogYm9vbGVhbjtcclxufVxyXG5cclxuYWJzdHJhY3QgY2xhc3MgVmVydGljYWxTY3JvbGxSZWFjaGVkIGV4dGVuZHMgU2Nyb2xsUmVhY2hlZCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgcHJvdGVjdGVkIGNvbnN0cnVjdG9yKEBPcHRpb25hbCgpIHByb3RlY3RlZCBzY3JvbGxiYXI6IE5nU2Nyb2xsYmFyLCBwcm90ZWN0ZWQgem9uZTogTmdab25lKSB7XHJcbiAgICBzdXBlcihzY3JvbGxiYXIsIHpvbmUpO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLnN1YnNjcmlwdGlvbiA9IHRoaXMuc2Nyb2xsYmFyLnZlcnRpY2FsU2Nyb2xsZWQuc3Vic2NyaWJlKHRoaXMuc2Nyb2xsRXZlbnQpO1xyXG4gIH1cclxufVxyXG5cclxuYWJzdHJhY3QgY2xhc3MgSG9yaXpvbnRhbFNjcm9sbFJlYWNoZWQgZXh0ZW5kcyBTY3JvbGxSZWFjaGVkIGltcGxlbWVudHMgT25Jbml0IHtcclxuICBwcm90ZWN0ZWQgY29uc3RydWN0b3IoQE9wdGlvbmFsKCkgcHJvdGVjdGVkIHNjcm9sbGJhcjogTmdTY3JvbGxiYXIsIHByb3RlY3RlZCB6b25lOiBOZ1pvbmUpIHtcclxuICAgIHN1cGVyKHNjcm9sbGJhciwgem9uZSk7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIHRoaXMuc3Vic2NyaXB0aW9uID0gdGhpcy5zY3JvbGxiYXIuaG9yaXpvbnRhbFNjcm9sbGVkLnN1YnNjcmliZSh0aGlzLnNjcm9sbEV2ZW50KTtcclxuICB9XHJcbn1cclxuXHJcbkBEaXJlY3RpdmUoe1xyXG4gIHNlbGVjdG9yOiAnW3JlYWNoZWRUb3BdLCBbcmVhY2hlZC10b3BdJyxcclxufSlcclxuZXhwb3J0IGNsYXNzIE5nU2Nyb2xsYmFyUmVhY2hlZFRvcCBleHRlbmRzIFZlcnRpY2FsU2Nyb2xsUmVhY2hlZCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcblxyXG4gIC8qKiBTdHJlYW0gdGhhdCBlbWl0cyB3aGVuIHNjcm9sbCBoYXMgcmVhY2hlZCB0aGUgdG9wICovXHJcbiAgQE91dHB1dCgpIHJlYWNoZWRUb3A6IE9ic2VydmFibGU8YW55PiA9IHRoaXMucmVhY2hlZEV2ZW50O1xyXG5cclxuICBjb25zdHJ1Y3RvcihAT3B0aW9uYWwoKSBwcm90ZWN0ZWQgc2Nyb2xsYmFyOiBOZ1Njcm9sbGJhciwgcHJvdGVjdGVkIHpvbmU6IE5nWm9uZSkge1xyXG4gICAgc3VwZXIoc2Nyb2xsYmFyLCB6b25lKTtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgc3VwZXIubmdPbkluaXQoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENoZWNrIGlmIHNjcm9sbCBoYXMgcmVhY2hlZCB0aGUgdG9wICh2ZXJ0aWNhbGx5KVxyXG4gICAqIEBwYXJhbSBvZmZzZXQgU2Nyb2xsIG9mZnNldFxyXG4gICAqIEBwYXJhbSBlIFNjcm9sbCBldmVudFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCByZWFjaGVkKG9mZnNldDogbnVtYmVyLCBlOiBhbnkpOiBib29sZWFuIHtcclxuICAgIHJldHVybiBSZWFjaGVkRnVuY3Rpb25zLnJlYWNoZWRUb3Aob2Zmc2V0LCBlKTtcclxuICB9XHJcbn1cclxuXHJcbkBEaXJlY3RpdmUoe1xyXG4gIHNlbGVjdG9yOiAnW3JlYWNoZWRCb3R0b21dLCBbcmVhY2hlZC1ib3R0b21dJyxcclxufSlcclxuZXhwb3J0IGNsYXNzIE5nU2Nyb2xsYmFyUmVhY2hlZEJvdHRvbSBleHRlbmRzIFZlcnRpY2FsU2Nyb2xsUmVhY2hlZCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcblxyXG4gIC8qKiBTdHJlYW0gdGhhdCBlbWl0cyB3aGVuIHNjcm9sbCBoYXMgcmVhY2hlZCB0aGUgYm90dG9tICovXHJcbiAgQE91dHB1dCgpIHJlYWNoZWRCb3R0b206IE9ic2VydmFibGU8YW55PiA9IHRoaXMucmVhY2hlZEV2ZW50O1xyXG5cclxuICBjb25zdHJ1Y3RvcihAT3B0aW9uYWwoKSBwcm90ZWN0ZWQgc2Nyb2xsYmFyOiBOZ1Njcm9sbGJhciwgcHJvdGVjdGVkIHpvbmU6IE5nWm9uZSkge1xyXG4gICAgc3VwZXIoc2Nyb2xsYmFyLCB6b25lKTtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgc3VwZXIubmdPbkluaXQoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENoZWNrIGlmIHNjcm9sbCBoYXMgcmVhY2hlZCB0aGUgYm90dG9tICh2ZXJ0aWNhbGx5KVxyXG4gICAqIEBwYXJhbSBvZmZzZXQgU2Nyb2xsIG9mZnNldFxyXG4gICAqIEBwYXJhbSBlIFNjcm9sbCBldmVudFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCByZWFjaGVkKG9mZnNldDogbnVtYmVyLCBlOiBhbnkpOiBib29sZWFuIHtcclxuICAgIHJldHVybiBSZWFjaGVkRnVuY3Rpb25zLnJlYWNoZWRCb3R0b20ob2Zmc2V0LCBlKTtcclxuICB9XHJcbn1cclxuXHJcbkBEaXJlY3RpdmUoe1xyXG4gIHNlbGVjdG9yOiAnW3JlYWNoZWRTdGFydF0sIFtyZWFjaGVkLXN0YXJ0XScsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBOZ1Njcm9sbGJhclJlYWNoZWRTdGFydCBleHRlbmRzIEhvcml6b250YWxTY3JvbGxSZWFjaGVkIGltcGxlbWVudHMgT25Jbml0IHtcclxuXHJcbiAgLyoqIFN0cmVhbSB0aGF0IGVtaXRzIHdoZW4gc2Nyb2xsIGhhcyByZWFjaGVkIHRoZSBzdGFydCAqL1xyXG4gIEBPdXRwdXQoKSByZWFjaGVkU3RhcnQ6IE9ic2VydmFibGU8YW55PiA9IHRoaXMucmVhY2hlZEV2ZW50O1xyXG5cclxuICBjb25zdHJ1Y3RvcihAT3B0aW9uYWwoKSBwcm90ZWN0ZWQgc2Nyb2xsYmFyOiBOZ1Njcm9sbGJhciwgcHJvdGVjdGVkIHpvbmU6IE5nWm9uZSwgcHJpdmF0ZSBkaXI6IERpcmVjdGlvbmFsaXR5KSB7XHJcbiAgICBzdXBlcihzY3JvbGxiYXIsIHpvbmUpO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICBzdXBlci5uZ09uSW5pdCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2hlY2sgaWYgc2Nyb2xsIGhhcyByZWFjaGVkIHRoZSBzdGFydCAoaG9yaXpvbnRhbGx5KVxyXG4gICAqIEBwYXJhbSBvZmZzZXQgU2Nyb2xsIG9mZnNldFxyXG4gICAqIEBwYXJhbSBlIFNjcm9sbCBldmVudFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCByZWFjaGVkKG9mZnNldDogbnVtYmVyLCBlOiBhbnkpOiBib29sZWFuIHtcclxuICAgIHJldHVybiBSZWFjaGVkRnVuY3Rpb25zLnJlYWNoZWRTdGFydChvZmZzZXQsIGUsIHRoaXMuZGlyLnZhbHVlLCB0aGlzLnNjcm9sbGJhci5tYW5hZ2VyLnJ0bFNjcm9sbEF4aXNUeXBlKTtcclxuICB9XHJcbn1cclxuXHJcbkBEaXJlY3RpdmUoe1xyXG4gIHNlbGVjdG9yOiAnW3JlYWNoZWRFbmRdLCBbcmVhY2hlZC1lbmRdJyxcclxufSlcclxuZXhwb3J0IGNsYXNzIE5nU2Nyb2xsYmFyUmVhY2hlZEVuZCBleHRlbmRzIEhvcml6b250YWxTY3JvbGxSZWFjaGVkIGltcGxlbWVudHMgT25Jbml0IHtcclxuXHJcbiAgLyoqIFN0cmVhbSB0aGF0IGVtaXRzIHdoZW4gc2Nyb2xsIGhhcyByZWFjaGVkIHRoZSBlbmQgKi9cclxuICBAT3V0cHV0KCkgcmVhY2hlZEVuZDogT2JzZXJ2YWJsZTxhbnk+ID0gdGhpcy5yZWFjaGVkRXZlbnQ7XHJcblxyXG4gIGNvbnN0cnVjdG9yKEBPcHRpb25hbCgpIHByb3RlY3RlZCBzY3JvbGxiYXI6IE5nU2Nyb2xsYmFyLCBwcm90ZWN0ZWQgem9uZTogTmdab25lLCBwcml2YXRlIGRpcjogRGlyZWN0aW9uYWxpdHkpIHtcclxuICAgIHN1cGVyKHNjcm9sbGJhciwgem9uZSk7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIHN1cGVyLm5nT25Jbml0KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDaGVjayBpZiBzY3JvbGwgaGFzIHJlYWNoZWQgdGhlIGVuZCAoaG9yaXpvbnRhbGx5KVxyXG4gICAqIEBwYXJhbSBvZmZzZXQgU2Nyb2xsIG9mZnNldFxyXG4gICAqIEBwYXJhbSBlIFNjcm9sbCBldmVudFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCByZWFjaGVkKG9mZnNldDogbnVtYmVyLCBlOiBhbnkpOiBib29sZWFuIHtcclxuICAgIHJldHVybiBSZWFjaGVkRnVuY3Rpb25zLnJlYWNoZWRFbmQob2Zmc2V0LCBlLCB0aGlzLmRpci52YWx1ZSwgdGhpcy5zY3JvbGxiYXIubWFuYWdlci5ydGxTY3JvbGxBeGlzVHlwZSk7XHJcbiAgfVxyXG59XHJcbiJdfQ==